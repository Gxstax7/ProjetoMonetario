<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Inicial</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    Sistema de Controle
</header>

<div class="container">

    <!-- TABELA MEUS BANCOS -->
    <div class="table-box">
        <h2>Meus Bancos</h2>
        <button id="buttonBanco">Criar</button>
        <table id="tabela-bancos">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Vencimento</th>
                    <th>Valor Total</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- Populado via JS -->
            </tbody>
        </table>
    </div>

    <!-- TABELA DEVEDORES -->
    <div class="table-box">
        <h2>Devedores</h2>
        <button id="buttonDevedor">Criar</button>
        <table id="tabela-devedores">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Valor Total</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- Populado via JS -->
            </tbody>
        </table>
    </div>

</div>

<!-- TABELA REGISTROS -->
<div class="registros-box">
    <h2>Registros</h2>
    <table id="tabela-registros">
        <thead>
            <tr>
                <th>Banco</th>
                <th>Devedor</th>
                <th>Valor</th>
                <th>Dia</th>
                <th>Descrição</th>
            </tr>
        </thead>
        <tbody>
            <!-- Populado via JS -->
        </tbody>
    </table>
</div>

<script>

    var buttonBanco = document.getElementById("buttonBanco");

    buttonBanco.addEventListener('click', function(event) {
        window.location.href='FormAttBancos.html';
    });

    async function carregarBancos() {
        try {
            const resposta = await fetch("http://localhost:8080/bancos/listarBancos");

            if (!resposta.ok) {
                throw new Error("Erro ao buscar bancos: " + resposta.status);
            }

            const bancos = await resposta.json();

            const tbody = document.querySelector("#tabela-bancos tbody");
            tbody.innerHTML = "";

            bancos.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td><a class="name-link" href="detalhes.html?id=${item.id}">${item.nome}</a></td>
                        <td>${item.dataFechamento}</td>
                        <td>${item.valorTotal || "R$ 0,00"}</td>
                        <td class="actions">
                            <button class="edit-btn" onclick="editar('banco', ${item.id})">Editar</button>
                            <button class="delete-btn" onclick="excluir('banco', ${item.id})">Excluir</button>
                        </td>
                    </tr>`;
            });

        } catch (erro) {
            console.error(erro);
            alert("Ocorreu um erro ao carregar os dados.");
        }
    }

    async function carregarDevedores() {
        try {
            const resposta = await fetch("http://localhost:8080/devedor/listarDevedores");
            if (!resposta.ok) {
                throw new Error("Erro ao buscar devedores: " + resposta.status);
            }

            const lista = await resposta.json();
            const tbody = document.querySelector("#tabela-devedores tbody");
            tbody.innerHTML = "";

            lista.forEach(item => {
                tbody.innerHTML += `
                <tr>
                    <td><a class="name-link" href="devedor.html?id=${item.id}">${item.nome}</a></td>
                    <td>${item.valorTotal || "R$ 0,00"}</td>
                    <td class="actions">
                        <button class="edit-btn" onclick="editarDevedor(${item.id})">Editar</button>
                        <button class="delete-btn" onclick="excluir('devedor', ${item.id})">Excluir</button>
                    </td>
                </tr>`;
            });

        } catch (erro) {
            console.error(erro);
            alert("Erro ao carregar devedores.");
        }
    }

    async function editarDevedor(id) {
        try{
            return await fetch ("http://localhost:8080/devedor/listarDevedores/$id");
        }catch (erro){
            console.error(erro);
            alert("Erro ao carregar devedores.");
        }
    }

    function excluir(tipo, id) {
        alert(`Excluir ${tipo} ID: ${id}`);
    }

    carregarBancos();
    carregarDevedores();
</script>

</body>
</html>